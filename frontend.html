<DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>V-School Lesson Assignments</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
        }
    </style>
</head>
<body class="bg-gray-100 p-8 flex flex-col items-center min-h-screen">

    <div class="bg-white shadow-xl rounded-2xl p-6 md:p-10 w-full max-w-4xl">
        <h1 class="text-3xl font-bold text-center text-gray-800 mb-6">V-School</h1>
        <p class="text-gray-600 text-center mb-8">Welcome To V-School</p>

        <div class="space-y-8">
            <div class="bg-gray-50 rounded-lg p-6 border border-gray-200">
                <h2 class="text-xl font-semibold mb-4 text-gray-700">REST API Endpoints</h2>
                <div class="space-y-2">
                    <pre class="bg-gray-200 p-2 rounded-md text-sm text-gray-800">
                        Only for understanding
POST    /api/assignments
PUT     /api/assignments/{assignmentId}/complete
GET     /api/assignments/me
                    </pre>
                </div>
            </div>

            <div class="bg-gray-50 rounded-lg p-6 border border-gray-200">
                <h2 class="text-xl font-semibold mb-4 text-gray-700">Assignment Flow Demonstration</h2>
                
                <div class="mb-6 space-y-4">
                    <div class="flex flex-col md:flex-row md:space-x-4 space-y-4 md:space-y-0 items-end">
                        <div class="w-full">
                            <label for="studentSelect" class="block text-sm font-medium text-gray-700">Select Student to Assign</label>
                            <select id="studentSelect" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md"></select>
                        </div>
                        <div class="w-full">
                            <label for="lessonSelect" class="block text-sm font-medium text-gray-700">Select Lesson to Assign</label>
                            <select id="lessonSelect" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md"></select>
                        </div>
                        <button id="assignLessonBtn" class="bg-blue-600 w-full md:w-auto text-white font-semibold py-2 px-4 rounded-xl hover:bg-blue-700 transition duration-300 transform hover:scale-105 shadow-md">
                            Assign Lesson
                        </button>
                    </div>

                    <div class="flex flex-col md:flex-row space-y-4 md:space-y-0 md:space-x-4 mt-6">
                        <button id="viewAllAssignmentsBtn" class="bg-green-600 w-full text-white font-semibold py-3 px-6 rounded-xl hover:bg-green-700 transition duration-300 transform hover:scale-105 shadow-md">
                            View Assignments
                        </button>
                        <button id="markCompleteBtn" class="bg-yellow-600 w-full text-white font-semibold py-3 px-6 rounded-xl hover:bg-yellow-700 transition duration-300 transform hover:scale-105 shadow-md">
                            Mark Lesson as Complete
                        </button>
                    </div>
                </div>
                
                <div id="output" class="mt-6 bg-white border border-gray-300 rounded-lg p-4 font-sm text-gray-700 overflow-auto max-h-96">
                    <p>API responses will appear here as you click the buttons.</p>
                </div>
            </div>
        </div>
    </div>

    <div id="modal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-lg shadow-xl p-6 max-w-sm w-full">
            <h3 class="text-lg font-bold mb-4 text-gray-800">Action Confirmation</h3>
            <p id="modalMessage" class="text-gray-600 mb-4"></p>
            <div class="flex justify-end">
                <button id="closeModalBtn" class="bg-blue-600 text-white font-semibold py-2 px-4 rounded-lg hover:bg-blue-700 transition duration-300">Close</button>
            </div>
        </div>
    </div>

    <script>
        const studentSelect = document.getElementById('studentSelect');
        const lessonSelect = document.getElementById('lessonSelect');
        const assignLessonBtn = document.getElementById('assignLessonBtn');
        const viewAllAssignmentsBtn = document.getElementById('viewAllAssignmentsBtn');
        const markCompleteBtn = document.getElementById('markCompleteBtn');
        const outputDiv = document.getElementById('output');
        const modal = document.getElementById('modal');
        const modalMessage = document.getElementById('modalMessage');
        const closeModalBtn = document.getElementById('closeModalBtn');

        const students = [{ id: 's_101', name: 'Alice' }, { id: 's_102', name: 'Bob' }, { id: 's_103', name: 'Charlie' }];
        const lessons = [{ id: 'l_1', name: 'Algebra Fundamentals' }, { id: 'l_2', name: 'Introduction to Biology' }, { id: 'l_3', name: 'World History' }];

        const populateSelect = (selectElement, data) => {
            selectElement.innerHTML = '';
            data.forEach(item => {
                const option = document.createElement('option');
                option.value = item.id;
                option.textContent = item.name;
                selectElement.appendChild(option);
            });
        };

        populateSelect(studentSelect, students);
        populateSelect(lessonSelect, lessons);

        const showModal = (message) => {
            modalMessage.textContent = message;
            modal.classList.remove('hidden');
        };

        const displayOutput = (data, title = 'API Response') => {
            outputDiv.innerHTML = `<p class="font-bold text-gray-900">${title}</p>`;
            
            if (data.message) {
                outputDiv.innerHTML += `<p class="mt-2 text-sm text-gray-700">${data.message}</p>`;
            } else if (data.assignments && data.assignments.length > 0) {
                let assignmentsHtml = `<ul class="mt-2 space-y-4">`;
                data.assignments.forEach(assign => {
                    const statusColor = assign.status === 'completed' ? 'text-green-600' : 'text-yellow-600';
                    assignmentsHtml += `
                        <li class="bg-gray-100 p-4 rounded-lg shadow-sm">
                            <div class="flex justify-between items-center mb-1">
                                <span class="font-semibold text-gray-800">${assign.lesson_name}</span>
                                <span class="text-sm ${statusColor}">${assign.status}</span>
                            </div>
                            <p class="text-xs text-gray-500">
                                Assigned to: ${assign.student_name} by ${assign.teacher_name}
                            </p>
                        </li>
                    `;
                });
                assignmentsHtml += `</ul>`;
                outputDiv.innerHTML += assignmentsHtml;
            } else {
                 outputDiv.innerHTML += `<p class="mt-2 text-sm text-gray-700">No assignments to display for this user.</p>`;
            }
        };
        
        const assignLesson = async () => {
            const studentId = studentSelect.value;
            const lessonId = lessonSelect.value;
            
            const payload = {
                teacherId: 'user-1',
                studentId: studentId,
                lessonId: lessonId,
            };

            try {
                const response = await fetch('http://127.0.0.1:5000/api/assignments', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(payload)
                });

                if (response.ok) {
                    const result = await response.json();
                    displayOutput({ message: `Assignment created for ${studentSelect.options[studentSelect.selectedIndex].text} successfully.` }, 'Assign Lesson (POST)');
                    showModal(`Assignment created for ${studentSelect.options[studentSelect.selectedIndex].text}.`);
                } else {
                    const error = await response.json();
                    displayOutput({ message: `Error: ${error.error}` }, 'Error');
                }
            } catch (error) {
                displayOutput({ message: `Failed to connect to server. Please ensure the backend is running.` }, 'Error');
            }
        };

        const viewAllAssignments = async () => {
            try {
                const response = await fetch(`http://127.0.0.1:5000/api/assignments/me?userId=user-1`);
                
                if (response.ok) {
                    const result = await response.json();
                    displayOutput(result, 'View All My Assignments (GET)');
                } else {
                    const error = await response.json();
                    displayOutput({ message: `Error: ${error.error}` }, 'Error');
                }
            } catch (error) {
                displayOutput({ message: `Failed to connect to server. Please ensure the backend is running.` }, 'Error');
            }
        };

        const markLessonComplete = async () => {
            try {
                const myAssignmentsResponse = await fetch(`http://127.0.0.1:5000/api/assignments/me?userId=user-1`);
                if (!myAssignmentsResponse.ok) {
                    const error = await myAssignmentsResponse.json();
                    displayOutput({ message: `Error fetching assignments to mark complete: ${error.error}` }, 'Error');
                    return;
                }
                const myAssignments = await myAssignmentsResponse.json();
                
                const incompleteAssignment = myAssignments.assignments.find(a => a.student_id === 's_101' && a.status === 'incomplete');

                if (!incompleteAssignment) {
                    showModal(`No incomplete lessons to mark complete.`);
                    displayOutput({ message: `No incomplete lessons to mark complete.` }, 'Info');
                    return;
                }
    
                const response = await fetch(`http://127.0.0.1:5000/api/assignments/${incompleteAssignment.assignment_id}/complete`, {
                    method: 'PUT',
                });
                
                if (response.ok) {
                    const result = await response.json();
                    displayOutput({ message: `Assignment marked as complete successfully.` }, 'Mark Lesson Complete (PUT)');
                    showModal(`A lesson has been marked as complete.`);
                } else {
                    const error = await response.json();
                    displayOutput({ message: `Error: ${error.error}` }, 'Error');
                }
            } catch (error) {
                displayOutput({ message: `Failed to connect to server. Please ensure the backend is running.` }, 'Error');
            }
        };

        assignLessonBtn.addEventListener('click', assignLesson);
        viewAllAssignmentsBtn.addEventListener('click', viewAllAssignments);
        markCompleteBtn.addEventListener('click', markLessonComplete);
        closeModalBtn.addEventListener('click', () => modal.classList.add('hidden'));
        
    </script>

</body>
</html>


